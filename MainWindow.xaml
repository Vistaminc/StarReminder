<Window x:Class="MediaDetectionSystem.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="StarReminder - 星熠提醒" Height="720" Width="1080"
        WindowStartupLocation="CenterScreen"
        FontFamily="Microsoft YaHei UI, HarmonyOS Sans SC"
        Background="#F5F7FA"
        Icon="logo.png">

    <Window.Resources>
        <!-- 主色调 -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#2D7FF9"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#00C48C"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#FFA940"/>
        <SolidColorBrush x:Key="DangerBrush" Color="#FF4757"/>
        
        <!-- 卡片样式 -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.05" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 图标按钮样式 -->
        <Style x:Key="IconButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                               CornerRadius="6"
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F0F2F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Switch开关 -->
        <Style x:Key="SwitchStyle" TargetType="CheckBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Border x:Name="SwitchBorder" 
                               Width="44" 
                               Height="24" 
                               CornerRadius="12" 
                               Background="#DDE1E6"
                               Cursor="Hand">
                            <Ellipse x:Name="SwitchThumb" 
                                    Width="18" 
                                    Height="18" 
                                    Fill="White" 
                                    HorizontalAlignment="Left" 
                                    Margin="3,0,0,0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="SwitchBorder" Property="Background" Value="#2D7FF9"/>
                                <Setter TargetName="SwitchThumb" Property="HorizontalAlignment" Value="Right"/>
                                <Setter TargetName="SwitchThumb" Property="Margin" Value="0,0,3,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 状态卡片 -->
        <Style x:Key="StatusCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.04" BlurRadius="12" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#2D7FF9" Opacity="0.15" BlurRadius="16" ShadowDepth="4"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 顶部导航 -->
        <Border Grid.Row="0" Background="White" Height="56" Padding="20,0">
            <Border.Effect>
                <DropShadowEffect Color="#000000" Opacity="0.03" BlurRadius="8" ShadowDepth="2"/>
            </Border.Effect>
            
    <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo、标题和管理员状态 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <!-- Logo图标 -->
                    <Image Source="logo.png" 
                           Width="32" 
                           Height="32" 
                           Margin="0,0,12,0"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                    
                    <StackPanel VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="StarReminder" 
                                      FontSize="16" 
                                      FontWeight="Bold" 
                                      Foreground="#1F2937"/>
                            <!-- 管理员状态 - 简洁文字，放在第一行 -->
                            <TextBlock x:Name="AdminStatusText" 
                                      Text="普通用户" 
                                      FontSize="10" 
                                      Foreground="#9CA3AF"
                                      Margin="12,0,0,0"
                                      VerticalAlignment="Center"
                                      ToolTip="当前运行权限"/>
                        </StackPanel>
                        <TextBlock Text="星熠提醒 · 媒体监控" 
                                  FontSize="10" 
                                  Foreground="#9CA3AF"
                                  Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- 右侧操作区 -->
                <StackPanel Grid.Column="2" 
                           Orientation="Horizontal" 
                           VerticalAlignment="Center">
                    <!-- 状态指示 - 紧贴开关 -->
                    <StackPanel Orientation="Horizontal" 
                               VerticalAlignment="Center"
                               Margin="0,0,8,0">
                        <!-- 状态点 -->
                        <Ellipse Width="8" Height="8" Margin="0,0,6,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="#DDE1E6"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SystemEnabled}" Value="True">
                                            <Setter Property="Fill" Value="#00C48C"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        
                        <TextBlock FontSize="13" Foreground="#6B7280">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="已停用"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SystemEnabled}" Value="True">
                                            <Setter Property="Text" Value="运行中"/>
                                            <Setter Property="Foreground" Value="#00C48C"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                    
                    <!-- 开关 -->
                    <CheckBox x:Name="SystemEnabledCheckBox" 
                             IsChecked="{Binding SystemEnabled}"
                             Style="{StaticResource SwitchStyle}"
                             Margin="0,0,12,0"/>

                    <!-- 设置按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" Click="SettingsButton_Click" ToolTip="设置">
                        <Viewbox Width="18" Height="18">
                            <Canvas Width="24" Height="24">
                                <Path Data="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66z" 
                                      Fill="#6B7280"/>
                            </Canvas>
                        </Viewbox>
                    </Button>

                    <!-- 最小化按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" Click="MinimizeButton_Click" Margin="4,0,0,0">
                        <TextBlock Text="─" FontSize="14" Foreground="#6B7280" Margin="0,-4,0,0"/>
                    </Button>

                    <!-- 关闭按钮 -->
                    <Button Style="{StaticResource IconButtonStyle}" Click="CloseButton_Click" Margin="4,0,0,0">
                        <TextBlock Text="✕" FontSize="14" Foreground="#6B7280"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 主内容 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20,16">
            <StackPanel>
                <!-- 进程监控卡片 -->
                <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal">
                                <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                    <Canvas Width="24" Height="24">
                                        <Path Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z" 
                                              Fill="#2D7FF9"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="进程监控" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Foreground="#1F2937"
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>

                        <!-- 状态卡片网格 -->
                        <ItemsControl ItemsSource="{Binding ProcessStatuses}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="3"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource StatusCardStyle}"
                                           Margin="0,0,12,0"
                                           MouseLeftButtonDown="ProcessCard_Click"
                                           Tag="{Binding ProcessName}">
                                        <StackPanel>
                                            <!-- 图标和标题 -->
                                            <Grid Margin="0,0,0,16">
                                                <StackPanel Orientation="Horizontal">
                                                    <!-- 图标 -->
                                                    <Viewbox Width="24" Height="24" Margin="0,0,10,0">
                                                        <Canvas Width="24" Height="24">
                                                            <Path Fill="#6B7280">
                                                                <Path.Style>
                                                                    <Style TargetType="Path">
                                                                        <!-- 默认图标 -->
                                                                        <Setter Property="Data" Value="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                                                                        <Style.Triggers>
                                                                            <!-- 摄像头图标 -->
                                                                            <DataTrigger Binding="{Binding ProcessName}" Value="media_capture.exe">
                                                                                <Setter Property="Data" Value="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                                                                            </DataTrigger>
                                                                            <!-- 屏幕捕获图标 -->
                                                                            <DataTrigger Binding="{Binding ProcessName}" Value="screenCapture.exe">
                                                                                <Setter Property="Data" Value="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"/>
                                                                            </DataTrigger>
                                                                            <!-- 远程控制图标（电脑图标） -->
                                                                            <DataTrigger Binding="{Binding ProcessName}" Value="rtcRemoteDesktop.exe">
                                                                                <Setter Property="Data" Value="M4 6h16v2H4zm0 5h16v6H4zm2 2h12v2H6z"/>
                                                                            </DataTrigger>
                                                                            <!-- 运行中时变色 -->
                                                                            <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                                <Setter Property="Fill" Value="#00C48C"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </Canvas>
                                                    </Viewbox>
                                                    
                                                    <TextBlock Text="{Binding DisplayName}" 
                                                              FontSize="15" 
                                                              FontWeight="SemiBold" 
                                                              Foreground="#1F2937"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- 状态 -->
                                            <Border CornerRadius="6" Padding="12,8" Margin="0,0,0,12">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="#F3F4F6"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                <Setter Property="Background" Value="#D1FAE5"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                
                                                <TextBlock FontSize="13" FontWeight="Medium" HorizontalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="未运行"/>
                                                            <Setter Property="Foreground" Value="#6B7280"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                    <Setter Property="Text" Value="运行中"/>
                                                                    <Setter Property="Foreground" Value="#00C48C"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>

                                            <!-- 运行时间 -->
                                            <TextBlock Text="{Binding RunTimeText}" 
                                                      FontSize="12" 
                                                      Foreground="#9CA3AF" 
                                                      HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- 活动日志卡片 -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <Grid Margin="0,0,0,16">
                            <StackPanel Orientation="Horizontal">
                                <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                    <Canvas Width="24" Height="24">
                                        <Path Data="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" 
                                              Fill="#2D7FF9"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="活动日志" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Foreground="#1F2937"
                                          VerticalAlignment="Center"/>
                            </StackPanel>

                            <Button x:Name="BtnClearLog"
                                   Content="清空" 
                                   FontSize="12" 
                                   Foreground="#6B7280" 
                                   Background="Transparent"
                                   BorderBrush="#E5E7EB"
                                   BorderThickness="1"
                                   Padding="12,6"
                                   Cursor="Hand"
                                   HorizontalAlignment="Right"
                                   Click="BtnClearLog_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                               BorderBrush="{TemplateBinding BorderBrush}"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               CornerRadius="6"
                                               Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#FEF2F2"/>
                                                <Setter Property="BorderBrush" Value="#FF4757"/>
                                                <Setter Property="Foreground" Value="#FF4757"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>

                        <Border Background="#F9FAFB" 
                               CornerRadius="8" 
                               BorderBrush="#E5E7EB" 
                               BorderThickness="1">
                            <ListBox x:Name="LogListBox"
                                    ItemsSource="{Binding LogEntries}" 
                                    Height="240"
                                    BorderThickness="0"
                                    Background="Transparent">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" 
                                                  FontFamily="Cascadia Code, Consolas" 
                                                  FontSize="11"
                                                  Foreground="#374151"
                                                  Padding="12,6"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0"/>
                                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                        <Setter Property="BorderBrush" Value="#F3F4F6"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#EFF6FF"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
